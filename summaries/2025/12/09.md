# Activity Summary for 09/12/2025

## 13:54:18
The `/Users/collin/projects/hrms/hrdirect-mcs-api/package.json` file was updated on **09/12/2025, 13:02:01**. This file outlines the project configuration, dependencies, and scripts for the `hrdirect` REST API MODEL-CONTROLLER-SERVICES application.

**Key updates and information from this file include:**

*   **Project Metadata:** The project is named `hrdirect`, version `1.0.0`, described as a "REST API MODEL-CONTROLLER-SERVICES". It's authored by "Support @ NATHAN DIGITAL" and licensed under "NathanDigital". The repository is hosted on Bitbucket.
*   **Node.js Environment:** The project specifies `node: "14.18.0"` and `npm: ">=6.14.15"` in `engines`, and `volta` also specifies `node: "14.18.3"`, indicating a preference for Node.js version 14.
*   **Scripts:** A comprehensive set of scripts is defined for various stages:
    *   **Deployment:** `start`, `staging`, `production` scripts use `pm2` with `ecosystem.config.json` for environment-specific deployments. A `shh` script is also available for stopping pm2.
    *   **Development:** `dev` uses `cross-env` and `nodemon`.
    *   **Testing:** `test`, `test:watch`, `coverage`, and `coverage:coveralls` use `jest` for unit and integration testing, including coverage reporting.
    *   **Code Quality:** `lint`, `lint:fix` (ESLint) and `prettier`, `prettier:fix` are configured for code style and formatting enforcement.
    *   **Docker:** `docker:prod`, `docker:dev`, `docker:test` scripts provide Docker Compose commands for different environments.
    *   **Hooks:** `prepare` uses `husky install` for Git hooks.
*   **Dependencies:** The project has an extensive list of dependencies, indicating a feature-rich application. Notable categories include:
    *   **NathanGroup specific packages:** A large number of internal packages are utilized, such as `@nathangroup/apm`, `@nathangroup/attendance`, `@nathangroup/claim`, `@nathangroup/leave`, `@nathangroup/letter`, `@nathangroup/payroll`, `@nathangroup/ssomatrix`, and `@nathangroup/wfh`, many of which also have associated email notification packages (e.g., `attendance-email`, `claim-email`). This highlights a strong integration with NathanGroup's internal ecosystem for HR-related functionalities.
    *   **Web Framework & Security:** `express`, `cors`, `helmet`, `compression`, `morgan`, `express-rate-limit`, `express-mongo-sanitize`, `xss-clean` for API development and security.
    *   **Authentication & Authorization:** `bcrypt`, `bcryptjs`, `jsonwebtoken`, `jwt-decode`, `passport`, `passport-jwt`, `@azure/msal-node`, `google-auth-library`, `googleapis`, `firebase-admin`, `speakeasy` for robust authentication mechanisms.
    *   **Database:** `mongodb` and `mongoose` for database interactions.
    *   **Cloud Services:** `@aws-sdk/client-s3`, `aws-sdk`, `multer-s3` for AWS S3 integration, and `@google-cloud/translate` for translation services.
    *   **File & Document Processing:** A significant number of packages for handling files, PDFs, and images including `express-fileupload`, `multer`, `pdf-creator-node`, `pdf-img-convert`, `pdf-lib`, `pdf-parse`, `pdf-poppler`, `pdf2image`, `pdfkit`, `pdfkit-table`, `pdfmake`, `sharp`, `exceljs`, `xlsx`, `csv-parser`, `json-2-csv`. This suggests heavy document generation and manipulation capabilities.
    *   **Emailing:** `@sendgrid/mail` and `nodemailer`.
    *   **Queueing & Background Jobs:** `bullmq`, `@bull-board/api`, `@bull-board/express`, `@bull-board/ui`, `ioredis`, `node-cron` for handling asynchronous tasks and job scheduling.
    *   **Utilities:** `axios`, `date-fns`, `moment`, `moment-timezone`, `dotenv`, `validator`, `crypto`, `dottie`, `socket.io` for various helper functions and real-time communication.
*   **Dev Dependencies:** Standard development tools like `eslint`, `prettier`, `jest`, `nodemon`, `supertest`, `husky`, `lint-staged` are included for testing, linting, and code formatting. `faker` is present for generating test data.
*   **Overrides:** `puppeteer` version is explicitly overridden to `^22.8.2`.

**Patterns and Recurring Elements:**

*   **HR-centric Functionality:** The repeated use of `@nathangroup` packages for attendance, claims, leave, payroll, WFH, and letters, along with their associated email modules, strongly indicates that the application is a core component of an HR Management System.
*   **Comprehensive Tooling:** The project employs a wide array of tools for every stage of development and deployment, from local development (nodemon, docker-compose dev) to production (pm2, docker-compose prod), testing (jest, supertest), and code quality (eslint, prettier, husky).
*   **Extensive Document Handling:** The numerous PDF and Excel-related packages highlight a critical need for generating, processing, and converting various documents within the system.
*   **Distributed System Design:** The inclusion of `bullmq`, `ioredis`, and `node-cron` points towards an architecture that handles background jobs and potentially scales asynchronous operations.
*   **Cloud Integration:** The use of AWS S3, Azure MSAL, and Google Cloud services suggests the application leverages external cloud platforms for various functionalities like storage, authentication, and translation.

## 14:54:24
The `package.json` file for the `hrdirect-mcs-api` was updated on 09/12/2025, 13:02:01. This update defines the project's metadata, including its name "hrdirect" and version "1.0.0", describes it as a "REST API MODEL-CONTROLLER-SERVICES", and specifies Node.js 14.18.0 and npm >=6.14.15 as required engines. The scripts section outlines commands for starting the application in various environments (start, staging, production via pm2), development (nodemon), testing (jest, coverage), linting (eslint), code formatting (prettier), and Docker operations. A significant number of dependencies are listed, many from the `@nathangroup/` scope, indicating modules for HRM functionalities like attendance, claim, leave, payroll, SSO, and workflow from NathanDigital. Other key dependencies include AWS S3, Azure MSAL, BullMQ, Firebase Admin, Google APIs, Moment.js, Mongoose, Nodemailer, Passport, PDF generation libraries, Socket.IO, and Swagger. Development dependencies include testing tools like Jest and Supertest, and code quality tools like Eslint and Prettier.

Multiple log entries between 09/12/2025, 13:57:14 and 09/12/2025, 14:09:47 show the content of `/Users/collin/projects/hrms/hrdirect-admin/components/Bell.vue`. The content remains largely consistent across these timestamps. This Vue.js component implements a notification bell functionality in the HRDirect admin panel. It displays a badge with the count of unread notifications, a dropdown menu with a scrollable list of recent notifications, and options to "Mark as read" or "See all". Functionalities include fetching user information, asynchronously loading notifications with infinite scrolling, formatting dates using Moment.js, and handling navigation to specific sections or requests when a notification is clicked. Notifications are displayed with an avatar, type, text, and date, with "NEW" chips for unread ones.

A significant change to `/Users/collin/projects/hrms/hrdirect-admin/components/Bell.vue` occurred on 09/12/2025, 14:47:46. The `openUrl` method was modified to introduce a `correctedHash` logic. This update maps old, specific tab names (e.g., 'leave', 'wfh', 'claim', 'attendance', 'lieu') to a generic 'requests' tab when navigating from a notification URL, indicating a consolidation or refactoring of frontend routing for different request types. A `console.log` statement was also added to aid in debugging notification click navigation.

The file `/Users/collin/projects/hrms/hrdirect-mcs-api/src/services/leave_request.service.js` was updated on 09/12/2025, 14:28:19. This backend service manages the creation of leave requests. Key aspects of this update include:
- Extensive imports of Mongoose models and utility functions related to user management, companies, notifications, approvals, payroll, email, and S3 file uploads.
- Definition of numerous constants for leave statuses, durations, types (e.g., "Hajj Leaves", "Maternity Leaves", "Annual Leaves"), and employee attributes.
- The `createLeaveRequest` function handles:
    - Retrieving applicant and manager details.
    - Validating and dynamically resolving approvers based on predefined approval flows, including line manager and senior manager, and de-duplicating approvers.
    - Performing comprehensive leave balance checks, considering scenarios like unpaid leave capping, allowing negative balances, and lumpsum usage.
    - Validating eligibility for half-day leaves based on leave type.
    - Generating the leave request object and checking company-specific leave configurations (e.g., "Emergency Leaves").
    - Incorporating optional air ticket details for annual leave requests.
    - Calculating potential leave salary if requested and applicable.
    - Implementing an auto-approval mechanism where a substitute approver is used if the primary approver is on leave and has a substitute configured.
- The content concludes while detailing the push of application logs, suggesting further logging or state management for the leave request process.

**Patterns/Recurring Elements:**
- **Consistent Timestamps:** All changes occurred on 09/12/2025, indicating a concentrated period of development or deployment activity.
- **Microservice/Modular Architecture:** The `package.json` with `@nathangroup/` prefixed dependencies and distinct `hrdirect-mcs-api` and `hrdirect-admin` directories suggests a microservice or modular application structure with a separate API backend and admin frontend.
- **Notification Functionality Focus:** Multiple, nearly identical entries for `Bell.vue` followed by a functional update highlight a focus on refining the notification user experience and navigation within the admin frontend.
- **Robust Leave Management:** The detailed logic in `leave_request.service.js` demonstrates a complex and comprehensive leave request processing system, covering approvals, balance checks, special leave types, and integration with payroll and notifications.
- **Internationalization:** The usage of `this.$t` in the Vue component and `moment(date).locale(this.$i18n.locale)` indicates support for multiple languages.