# Activity Summary for 28/11/2025

## 08:54:27
The code changes primarily focus on enhancing and refining a leave management system across its API service and administrative frontend component.

In `/Users/collin/projects/ngex/ngex-api/src/services/leave_request.service.js` (28/11/2025, 08:13:35):
The `leave_request.service.js` file introduces significant logic for creating and processing leave requests. It imports a wide array of models and utilities, indicating a complex, interconnected system.
- **Extensive Imports:** The service relies on numerous models (e.g., `Requests`, `User`, `Companies`, `Approvals`, `Notifications`, `PayrollProcess`), external libraries (`@nathangroup/leave`, `lodash`, `moment-timezone`), and custom helpers/utilities for notifications, emails, S3 uploads, and pay item creation.
- **Comprehensive Constants:** A `CONST` object is defined with various statuses, leave types (e.g., 'pilgrimage leaves', 'maternity leaves', 'annual leaves'), durations, and conditions, highlighting a highly configurable leave system.
- **`createLeaveRequest` Function:** This function orchestrates the entire leave application process:
    - **User and Approval Flow Validation:** It fetches applicant and manager details, rigorously checks if an approval flow is configured, and ensures the applicant has a reporting manager.
    - **Dynamic Approver Assignment:** It dynamically updates approver levels within the approval flow, replacing placeholder IDs (`line_manager_id`, `senior_manager_id`) with actual user IDs and handling unique approvers.
    - **Leave Balance and Eligibility Checks:** It performs detailed calculations and validations for leave balance, considering parameters like `unpaid_leave_capped`, `apply_below_zero`, `max_allowed`, and `used_lumpsum`. It also verifies half-day eligibility for specific leave types.
    - **Air Ticket Integration:** For 'Annual Leaves', it includes logic to capture `air_ticket` details, including departure/arrival countries/airports and a specific `travel_date`.
    - **Automated Approval Logic:** A key feature introduced is the auto-approval mechanism. If an assigned approver is on leave during the requested period, their approval is marked 'Auto Approved', and an `approval_substitute` (proxy approver) is inserted into the approval chain.
    - **Payroll Integration:** The service prepares the leave request object with a `payroll_process` field and calls `createNewPayItems` upon successful and completed leave applications, indicating integration with a payroll system.
    - **Application Logging:** `appliction_log` is updated to record approval actions, especially for auto-approved cases.

In `/Users/collin/projects/ngex/ngex-admin/components/reuseable/createLeaves.vue` (28/11/2025, 08:37:15):
The `createLeaves.vue` component provides the user interface for applying for leaves in the admin panel.
- **Leave Summary Display:** It prominently displays `no_of_days`, `remaining_leaves`, `unpaid_leave_count` (for overflow scenarios), and a detailed `sick_leave_breakdown` (Paid, HalfPaid, Unpaid), offering clear visibility of leave entitlements. Loading states are indicated with progress circulars.
- **Dynamic Form Fields:** The form adjusts based on selections:
    - **Leave Type and Options:** Allows selecting a leave type (with translated names) and a half-day/full-day option if `isHalfDayAvailable`.
    - **Date Pickers:** Provides intuitive date pickers for `from_date`, `to_date`, with validation for minimum dates and locale support.
    - **Air Ticket Fields:** Conditionally displays detailed fields for `Departure Country/Airport`, `Arrival Country/Airport`, and `Travel Date` exclusively for 'Annual Leaves' when the `Air Ticket` checkbox is selected. The travel date picker excludes declared holidays.
- **Document Upload and Leave Buddy:** Users can upload supporting documents (`certificate`) with required validation and select a `leave_buddy_id`.
- **Reason Field:** A mandatory `reason` text area is included.
- **Submission Logic:** The "Submit" button (`applyLeave`) has extensive disabling conditions based on various states and computed properties (e.g., `newLeaveProgress`, `computeAddRequestButton`, `computedCheckLeaveBlackout`, `computeHajjLeave`), preventing invalid submissions.
- **Component Data:** The script section defines various data properties to manage form state, leave counts, loading indicators, validation rules, holiday lists (`delcared_holidays`), and specific configurations like `min_days_before_start`, `blackout_start_date`, and `blackout_end_date`, hinting at blackout period functionality. It also uses `@nathangroup/leave` for shared leave logic.

**Patterns and Recurring Elements:**
- **Comprehensive Leave Management:** Both files are integral to a feature-rich leave management system, covering application, approval, validation, and payroll integration.
- **Shared Logic Library:** The `@nathangroup/leave` library is utilized by both the backend service and the frontend component, suggesting a standardized approach to leave-related calculations and rules.
- **Detailed Date and Time Handling:** Both components extensively manage dates (`from_date`, `to_date`, `travel_date`, `blackout_start_date`, `blackout_end_date`, `delcared_holidays`), emphasizing precision in leave duration and eligibility.
- **Approval Workflow Integration:** A robust multi-level approval process is evident, involving dynamic approver assignment and automated substitute approvals.
- **User-Specific Configuration:** The system tailors leave options and validations based on user-specific data (e.g., `applicant.leaves`, `obj_leave_type`, `selectedEmp`, `userType`).
- **Internationalization (i18n):** The frontend component shows clear support for multiple languages with `$t()` directives and locale-aware date pickers.
- **Modularity:** The use of helper functions, email templates, and a dedicated queue (`bulk_leaves_upload.queue`) indicates a modular architecture.
- **Emphasis on Validation and User Feedback:** Both parts incorporate numerous validation checks and UI feedback mechanisms (e.g., error messages, progress indicators, success alerts) to guide users through the application process.

## 10:01:49
The changes detail updates across two key Vue components in an HR management system admin panel, focusing on user profiles and reporting structures.

**File: `/Users/collin/projects/ccl/ccl-hrms-admin/pages/user/profile/index.vue`**
*   **Timestamp:** `28/11/2025, 09:37:21`
*   **Key Updates:** This file defines the comprehensive user profile page. It implements a conditional loading state displaying skeleton loaders for a smoother user experience. Once loaded, it presents the user's basic information (avatar, contract type, employee ID, status, full name, designation, contact details, and a change password option). The profile is organized into collapsible sections for 'Bio', 'Personal Information', 'Emergency Contact', 'Employment Information', and 'Compensation'. Each section features dynamic visibility and editability checks. The 'Compensation' section is particularly detailed, showing salary (masked if not visible) and an extensive breakdown of 'Employee Benefits', including Transport & Travel (car/fuel allowance, company bus, Salik), Insurance & Visa (medical insurance type, dependent coverage, family visa), and Accommodation benefits.

**File: `/Users/collin/projects/ccl/ccl-hrms-admin/components/profile/reporting-to.vue`**
*   This component underwent significant evolution across multiple timestamps on `28/11/2025`.
*   **Initial State (09:37:36):** The component was designed to display a user's "Work Anniversary" and "Years with us" along with information about their direct "Reporting To" manager. It included logic to fetch manager details from a Vuex store or via an API call, with a skeleton loader displayed during loading and a "Manager not found" message as a fallback.
*   **Debugging and Dotted Manager Introduction (09:53:00 - 09:59:11):**
    *   Several `console.log` statements were added to `fetchManager` (at 09:53:00 and 09:58:38) for debugging the manager data and payload structure.
    *   A new `dottedManager` data property and `isDottedManagerLoaded` flag were introduced (09:58:45).
    *   The `payload` watcher and `mounted` hook were updated to also trigger a new `fetchDottedManager` method.
    *   The `fetchDottedManager` method (fully visible at 09:59:05) was implemented to fetch a "dotted line manager" from `payload.reporting.dotted_manager` using similar logic to the primary manager, including local store lookup and API fallback, and its own debugging `console.log`.
*   **UI Expansion (09:59:27):** The component's template was updated to display a second `v-card` specifically for the "Dotted Line Manager" below the primary reporting manager card. This card also uses conditional rendering and a skeleton loader.
*   **Internationalization and Refinements (10:00:17 - 10:00:40):**
    *   Hardcoded strings for "Reporting To" and "Dotted Line Manager" were replaced with internationalization keys (`$t("myhr_reportingTo")`, `$t("myhr_dottedManager")`) at 10:00:17.
    *   Fallback text for "Manager not found" and "No dotted manager assigned" was also internationalized with keys like `$t("myhr_managerNotFound")` and `$t("myhr_noDottedManager")` at 10:00:23.
    *   Finally, the rendering condition for the Dotted Line Manager card was refined (10:00:40) to `v-if="payload?.reporting?.dotted_manager && (dottedManager || !isDottedManagerLoaded)"`, ensuring it only appears if a `dotted_manager` ID exists in the user's reporting structure.

**Patterns and Recurring Elements:**
*   **Vue.js Component Development:** Both files are Vue components, utilizing `template`, `script`, and `style` blocks.
*   **Dynamic Data Display and Loading States:** Both components show a strong pattern of handling asynchronous data loading with `v-if="loading"` or similar flags, and displaying `v-skeleton-loader` placeholders for a better user experience during data fetching.
*   **Internationalization (`$t`):** There's a clear trend towards using `$t()` for all user-facing text, indicating a focus on multi-language support.
*   **Conditional Rendering (`v-if`, `v-for`, `v-expand-transition`):** Extensively used to show/hide sections, iterate over data, and manage UI elements based on data availability, user permissions, or visibility states.
*   **User Profile Information Structure:** The `/user/profile/index.vue` file showcases a common HR system pattern of categorizing user data into sections like personal, employment, emergency, and compensation, with fine-grained control over component visibility and editability.
*   **Reporting Structure:** The `reporting-to.vue` component demonstrates a common HR requirement to display both direct and dotted-line reporting managers, with robust data fetching and display logic.
*   **Debugging Practices:** The `console.log` statements in `reporting-to.vue` highlight an iterative development process involving debugging data structures.

## 12:45:12
The log details changes exclusively within the file `/Users/collin/projects/ccl/ccl-hrms-admin/components/reports/bi-report.vue`. This file appears to be a Vue component responsible for displaying and managing BI (Business Intelligence) reports within an HRMS admin interface.

Key updates and their timestamps are as follows:

*   **28/11/2025, 12:34:42**: A textual title, "{{ $t("reports.reports_report_details") }}", was added to the header of the report details card (the right-hand panel). Previously, only an icon (`/hr/claim.svg`) was present in that section.
*   **28/11/2025, 12:35:43**: The "edit report" icon/button (`/shift/edit.svg`) was removed from the header of the report details card.
*   **28/11/2025, 12:36:44**: The "edit report" icon/button was re-added to the header of the report details card. Concurrently, the "download report" icon/button (`/reports/download.svg`) was removed from its `<span>` container within the same header, leaving an empty span.
*   **28/11/2025, 12:42:02**: The "download report" icon/button was re-added to its `<span>` container, restoring its presence in the header of the report details card.

**Patterns and Recurring Elements:**

*   All changes are focused on the template structure of the `bi-report.vue` component, specifically the header section of the right-hand panel which displays "Report Details" and its associated action buttons (edit, download, close).
*   There's a recurring pattern of adding, removing, and then re-adding specific UI elements (the edit and download icons) in quick succession, suggesting iterative adjustments, potentially bug fixes or refinements to the user interface's functionality or appearance.
*   The conditional rendering logic for these action buttons, based on `selectedReport` status, `editReport` mode, and user `access_rights` (including specific user IDs and an 'All' option), remains consistent across all modifications.
*   The timestamps are very close together, indicating a focused period of work on this particular UI section.

## 13:45:27
This log details changes exclusively within the `/Users/collin/projects/ccl/ccl-hrms-admin/components/reports/bi-report.vue` file on November 28, 2025, covering a period from 12:34:03 to 13:40:25.

**Key File-Specific Updates:**

*   **28/11/2025, 12:34:42**: The right-hand panel, which displays details for a selected report, was updated to include a clear title: "Report Details" (derived from `reports.reports_report_details` via internationalization). This title now appears alongside the `/hr/claim.svg` image in the `v-card-title`.
*   **28/11/2025, 12:35:43**: The "edit" icon (`/shift/edit.svg`) and its associated functionality (which would toggle `editReport` to `true`) were removed from the report details header. This change temporarily removed the user's ability to switch the report details into an editable state directly from the UI. Notably, the visibility condition for the download icon (`/reports/download.svg`) still included a check for `!editReport`, indicating a potential logical inconsistency given the removal of the edit toggle.
*   **28/11/2025, 12:36:44**: The "edit" icon (`/shift/edit.svg`) and its click handler (`@click="editReport = true"`) were restored to the report details header, reverting the change made at 12:35:43. This means the ability to toggle into edit mode for a report was reinstated.

The numerous other log entries between these timestamps (e.g., 12:42:02, 12:47:54, 12:48:03, etc., up to 13:40:25) show identical code content to the immediately preceding entry. This suggests frequent saves or automated formatting operations without substantive code modifications.

**Patterns and Recurring Elements:**

*   **Single File Focus**: All changes are concentrated on a single Vue component responsible for displaying and managing reports, indicating a focused development effort on this specific feature.
*   **Timestamp Clustering**: All significant changes, and many non-substantive saves, occurred on the same day within a relatively short timeframe (approximately an hour), highlighting a dedicated work session.
*   **UI Component Usage**: The component extensively uses Vuetify components for its layout and interactions, such as `v-row`, `v-col`, `v-card`, `v-list`, `v-dialog`, `v-form`, `v-text-field`, `v-textarea`, and `v-autocomplete`.
*   **Internationalization**: All user-facing text elements (e.g., report titles, button labels, form field placeholders) utilize `$t("...")` for internationalization, ensuring the application can support multiple languages.
*   **Data Display and Interaction**: The component displays a list of reports with details like name, process type, and creation date (formatted into day and month). It also includes a search bar for filtering reports and a dialog for adding new reports, as well as a section for viewing/editing selected report details.
*   **Access Control Logic**: Visibility for actions like editing or downloading reports is governed by complex `v-if` conditions that check if `selectedReport` exists, if the user's `_id` is included in `selectedReport.access_rights`, if the user has specific admin `_id`s, or if `access_rights` is set to 'All'. This indicates a granular permission system for reports.
*   **Conditional Report Naming**: Report names are dynamically changed to "Remote Work" if they contain "wfh" and "Out of Office" if they contain "trips", suggesting custom display logic for specific report types.